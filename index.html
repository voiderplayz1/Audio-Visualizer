<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Visualizer</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background-color: #0a0a0a; 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar Styling */
        #sidebar {
            width: 250px;
            background-color: #1a1a1a;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border-right: 2px solid #333;
            z-index: 10;
        }
        h2 { font-size: 1.2rem; margin-bottom: 10px; text-align: center; }
        
        .btn {
            background-color: #333;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            transition: background 0.3s;
        }
        .btn:hover { background-color: #555; }
        
        /* Hidden file input wrapped by a label button */
        input[type="file"] { display: none; }
        .upload-label { background-color: #e67e22; }
        .upload-label:hover { background-color: #d35400; }

        /* Main Content Styling */
        #main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Visualizer Canvas */
        canvas {
            flex-grow: 1;
            width: 100%;
            display: block;
        }

        /* Bottom Player */
        #player-container {
            background-color: #1a1a1a;
            padding: 15px;
            border-top: 2px solid #333;
        }
        
        /* The "thingy at the bottom" */
        audio {
            width: 100%;
            outline: none;
        }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>Visualizer Controls</h2>
        
        <label for="audio-upload" class="btn upload-label">Upload Track</label>
        <input type="file" id="audio-upload" accept=".mp3, .ogg, .wav, .flac" />
        
        <button id="btn-color" class="btn">Change Color</button>
        <button id="btn-preset" class="btn">Change Visualizer Mode</button>
        <button id="btn-remove" class="btn">Remove Track</button>
    </div>

    <div id="main">
        <canvas id="visualizer"></canvas>
        <div id="player-container">
            <audio id="audio-player" controls></audio>
        </div>
    </div>

    <script>
        const audioUpload = document.getElementById('audio-upload');
        const audioPlayer = document.getElementById('audio-player');
        const canvas = document.getElementById('visualizer');
        const ctx = canvas.getContext('2d');
        
        const btnColor = document.getElementById('btn-color');
        const btnPreset = document.getElementById('btn-preset');
        const btnRemove = document.getElementById('btn-remove');

        let audioCtx, analyser, source;
        let animationId;
        
        // Settings
        let visualizerMode = 0; // 0 = Waveform, 1 = Bars, 2 = Circular
        let currentColorIndex = 0;
        const colors = ['#e67e22', '#3498db', '#2ecc71', '#9b59b6', '#e74c3c', '#f1c40f'];

        // Resize canvas to fit screen
        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Handle File Upload
        audioUpload.addEventListener('change', function(e) {
            const file = this.files[0];
            if (!file) return;

            // Initialize Audio Context on first user interaction
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                source = audioCtx.createMediaElementSource(audioPlayer);
                source.connect(analyser);
                analyser.connect(audioCtx.destination);
            }

            const objectUrl = URL.createObjectURL(file);
            audioPlayer.src = objectUrl;
            audioPlayer.play();
            
            if (animationId) cancelAnimationFrame(animationId);
            drawVisualizer();
        });

        // Handle Track Removal
        btnRemove.addEventListener('click', () => {
            audioPlayer.pause();
            audioPlayer.removeAttribute('src');
            audioPlayer.load();
            audioUpload.value = ''; // Reset input
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear screen
            if (animationId) cancelAnimationFrame(animationId);
        });

        // Handle Color Change
        btnColor.addEventListener('click', () => {
            currentColorIndex = (currentColorIndex + 1) % colors.length;
        });

        // Handle Preset Change
        btnPreset.addEventListener('click', () => {
            visualizerMode = (visualizerMode + 1) % 3;
        });

        // Drawing Loop
        function drawVisualizer() {
            animationId = requestAnimationFrame(drawVisualizer);
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            // Clear previous frame with a slight fade for a glowing trail effect
            ctx.fillStyle = 'rgba(10, 10, 10, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.lineWidth = 3;
            ctx.strokeStyle = colors[currentColorIndex];
            ctx.fillStyle = colors[currentColorIndex];

            if (visualizerMode === 0) {
                // PRESET 1: Waveform (Like the video's erratic lines)
                analyser.getByteTimeDomainData(dataArray);
                ctx.beginPath();
                const sliceWidth = canvas.width * 1.0 / bufferLength;
                let x = 0;
                for (let i = 0; i < bufferLength; i++) {
                    const v = dataArray[i] / 128.0;
                    const y = v * canvas.height / 2;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                    x += sliceWidth;
                }
                ctx.lineTo(canvas.width, canvas.height / 2);
                ctx.stroke();

            } else if (visualizerMode === 1) {
                // PRESET 2: Frequency Bars
                analyser.getByteFrequencyData(dataArray);
                const barWidth = (canvas.width / bufferLength) * 2.5;
                let barHeight;
                let x = 0;
                for (let i = 0; i < bufferLength; i++) {
                    barHeight = dataArray[i] * 2;
                    ctx.fillRect(x, canvas.height - barHeight / 2, barWidth, barHeight / 2);
                    x += barWidth + 1;
                }
                
            } else if (visualizerMode === 2) {
                // PRESET 3: Circular Frequency
                analyser.getByteFrequencyData(dataArray);
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = Math.min(centerX, centerY) / 2;
                
                for (let i = 0; i < bufferLength; i++) {
                    const barHeight = dataArray[i];
                    const rads = Math.PI * 2 / bufferLength;
                    const x = centerX + Math.cos(rads * i) * (radius + barHeight);
                    const y = centerY + Math.sin(rads * i) * (radius + barHeight);
                    const xEnd = centerX + Math.cos(rads * i) * radius;
                    const yEnd = centerY + Math.sin(rads * i) * radius;
                    
                    ctx.beginPath();
                    ctx.moveTo(xEnd, yEnd);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                }
            }
        }
    </script>
</body>
</html>
